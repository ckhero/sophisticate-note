# RDB

## 简述

> 指定时间频率内对数据进行快照存储

## 策略

> save 900 10 每900s内产生10条数据则进行快照。或者900s触发快照，因为每个时间段的写是不均衡的

## 触发

> 1. save m n
> 2. 主从同步，触发bgsave
> 3. 执行debug reload
> 4. 执行shutdown

## 压缩？

> rdbccompression yes
>
> 不建议开始，redis本身就是CPU密集型服务器，开启压缩会带来更多的CPU消耗，相比硬盘来说，成本太高

## 优点

> * 文件紧凑，全量备份。适合灾备和恢复
>
> * 备份阶段 主进程fork一个子进程来处理所有保存工作，主进程不需要任何磁盘io
>
> * 恢复大数据的时候比aof快

## 缺点

> * 备份时间较长，备份期间宕机容易导致数据缺失
> * 无法实现秒级别和实时的数据备份

## 触发方式

> * 主动save
>   * 阻塞服务器，线上禁用
> * bgsave 
>   * fork子进程去处理，阻塞只发生再fork阶段。（可以通过控制单个redis实例最大内存来降低fork消耗，或者降低频率）

## 流程

> 1. bgsave开始
> 2. 判断是否已经有存在AOF/RDB子进程在处理，有的话直接退出
> 3. 触发持久化
> 4. fork子进程
> 5. 主进程继续响应服务，子进程进行备份



