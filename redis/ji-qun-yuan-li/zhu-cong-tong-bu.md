# 主从同步

> https://www.cnblogs.com/wuwuyong/p/11769355.html

## 流程

> 1. 从服务器发起同步请求
> 2. 主服务器开始BGSAVE生成RDB文件，并将之后的写命令利用缓冲记录下来
> 3. BGSAVE完成后发送RDB文件，并继续缓冲写命令
> 4. 从服务收到快照后，舍弃旧数据，导入RDB
> 5. 快照发送完成之后开始同步缓冲区的命令，最终从服务器完成初始化
> 6. 后续进行增量同步。先把写命令写入缓冲，然后以异步的方式发送给从服务器，从服务器也会向主服务器反馈同步进度

优点

> master自动同步给slave 读写分离，减轻master的读压力
>
> slave也可以同步给其他的salve，减轻master的同步压力
>
> maste非阻塞的为slave提供服务，同步期间，可以继续提供读写服务
>
> slave非阻塞的同步master的数据，同步期间，可以查询同步前的数据

缺点

> 不具备容错 和自动回复。master宕机需要等待重启或者切换ip
>
> 不具备高可用，master宕机后，未同步的数据为丢失，
>
> 多个salve重启的时候，分开重启，减轻master的io压力
>
> 较难支持在线扩容。扩容复杂



