# 注册中心

## 资料

> [https://blog.csdn.net/haponchang/article/details/93467008](https://blog.csdn.net/haponchang/article/details/93467008)



## 工作流程

> * 三大成员  **服务提供者，注册中心，服务消费者**
> * 服务提供者发起注册，并定期发送心跳给注册中心
> * 消费者订阅接口，获取可用的节点在本地缓存
> * 服务选在过程 本地-》快照-》注册中心
> * 消费者获取订阅服务列表的时候，就会订阅服务的变化，定期检查服务是否发生变化

## 注册中心类型

> CP 型注册中心，牺牲可用性来保证数据强一致性，最典型的例子就是 ZooKeeper，etcd，Consul 了。ZooKeeper 集群内只有一个 Leader，而且在 Leader 无法使用的时候通过 Paxos 算法选举出一个新的 Leader。这个 Leader 的目的就是保证写信息的时候只向这个 Leader 写入，Leader 会同步信息到 Followers，这个过程就可以保证数据的强一致性。但如果多个 ZooKeeper 之间网络出现问题，造成出现多个 Leader，发生脑裂的话，注册中心就不可用了。而 etcd 和 Consul 集群内都是通过 raft 协议来保证强一致性，如果出现脑裂的话， 注册中心也不可用。
>
>
>
> AP 型注册中心，牺牲一致性来保证可用性，最典型的例子就是 Eureka 了。对比下 Zookeeper，Eureka 不用选举一个 Leader，每个 Eureka 服务器单独保存服务注册地址，因此有可能出现数据信息不一致的情况。但是当网络出现问题的时候，每台服务器都可以完成独立的服务。



> 最主要的功能是服务的注册和发现，在网络出现问题的时候，可用性的需求要远远高于数据一致性。即使因为数据不一致，注册中心内引入了不可用的服务节点，也可以通过其他措施来避免，比如**客户端的快速失败机制**等，只要实现最终一致性，对于注册中心来说就足够了。因此，选择 AP 型注册中心，一般更加合适。







